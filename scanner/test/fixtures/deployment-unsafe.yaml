# Kubernetes Deployment inseguro — deve gerar múltiplas findings no Trivy
# Usado como fixture de teste para o Infra Scan

apiVersion: apps/v1
kind: Deployment
metadata:
  name: app-unsafe
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app: app-unsafe
  template:
    metadata:
      labels:
        app: app-unsafe
    spec:
      # PROBLEMA: hostNetwork habilitado (KSV006)
      hostNetwork: true
      # PROBLEMA: hostPID habilitado (KSV009)
      hostPID: true
      # PROBLEMA: hostIPC habilitado (KSV010)
      hostIPC: true
      # PROBLEMA: Sem securityContext no pod (KSV021)
      # PROBLEMA: Sem runAsNonRoot (KSV020)
      containers:
        - name: app
          image: node:latest
          ports:
            - containerPort: 3000
          # PROBLEMA: Container privilegiado (KSV014 — CRITICAL)
          securityContext:
            privileged: true
            allowPrivilegeEscalation: true
            # PROBLEMA: Sem readOnlyRootFilesystem (KSV012)
            # PROBLEMA: Capabilities não dropadas (KSV003)
          # PROBLEMA: Sem limites de CPU (KSV011)
          # PROBLEMA: Sem limites de memória (KSV013)
          # PROBLEMA: Sem probes
          env:
            - name: DB_PASSWORD
              value: "super_secret_123"
