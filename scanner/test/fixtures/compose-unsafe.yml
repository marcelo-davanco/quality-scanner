# docker-compose inseguro — deve gerar múltiplas findings no Trivy
# Usado como fixture de teste para o Infra Scan

version: "3.8"

services:
  app:
    image: node:latest
    container_name: app-unsafe
    # PROBLEMA: Container privilegiado
    privileged: true
    # PROBLEMA: Sem read_only
    # PROBLEMA: Sem user (roda como root)
    # PROBLEMA: Sem cap_drop
    # PROBLEMA: Portas expostas em todas as interfaces
    ports:
      - "3000:3000"
      - "9229:9229"
    # PROBLEMA: Volume com acesso total ao host
    volumes:
      - /:/host-root
      - /var/run/docker.sock:/var/run/docker.sock
    environment:
      NODE_ENV: development
      # PROBLEMA: Credenciais hardcoded
      DB_PASSWORD: super_secret_123
    # PROBLEMA: Sem healthcheck
    # PROBLEMA: Sem limites de recursos
    # PROBLEMA: Rede host
    network_mode: host
    restart: always

  db:
    image: postgres:latest
    # PROBLEMA: Sem read_only
    # PROBLEMA: Sem user
    environment:
      POSTGRES_PASSWORD: admin123
    ports:
      - "5432:5432"
    volumes:
      - /data:/var/lib/postgresql/data
