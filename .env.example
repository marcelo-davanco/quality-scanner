# ============================================================
# SonarQube — Server
# ============================================================
SONAR_PORT=9000

# Base SonarQube version used as FROM in sonarqube/Dockerfile
SONARQUBE_VERSION=25.10.0.114319-community

# Community Branch Plugin version to embed at build time
# Must match major.minor of SONARQUBE_VERSION
# Releases: https://github.com/mc1arke/sonarqube-community-branch-plugin/releases
SONAR_PLUGIN_VERSION=25.10.0

# Published image on GitHub Container Registry (built and pushed by CI)
# To use a specific version: ghcr.io/marcelo-davanco/sonarqube-with-community-branch-plugin:25.10.0
SONAR_IMAGE=ghcr.io/marcelo-davanco/sonarqube-with-community-branch-plugin:latest

SONAR_DB_IMAGE=postgres:15-alpine
SONAR_DB_USER=sonar
SONAR_DB_PASSWORD=sonar
SONAR_DB_NAME=sonarqube

# SonarQube admin credentials (used to generate tokens and create projects)
SONAR_ADMIN_USER=admin
SONAR_ADMIN_PASSWORD=admin

# ============================================================
# Scanner — Settings
# ============================================================
SONAR_HOST_URL=http://localhost:9000
SONAR_INTERNAL_URL=http://sonarqube:9000
SONAR_TOKEN=your_token_here
SONAR_PROJECT_KEY=my-project
SCANNER_IMAGE=quality-scanner:latest

# ============================================================
# Scanner — Phase Toggles (true/false)
# Each phase can be individually enabled or disabled.
# Phases 1–8 default to true; API Lint and Infra Scan default to false.
# ============================================================
ENABLE_GITLEAKS=true
ENABLE_TYPESCRIPT=true
ENABLE_ESLINT=true
ENABLE_PRETTIER=true
ENABLE_AUDIT=true
ENABLE_KNIP=true
ENABLE_JEST=true
ENABLE_SONARQUBE=true

# ============================================================
# API Lint — OpenAPI Contract Validation (Spectral)
# ============================================================
ENABLE_API_LINT=false
API_LINT_SEVERITY=warn
# Manual path to the OpenAPI file (leave empty for auto-detect)
OPENAPI_FILE_PATH=

# ============================================================
# Infra Scan — Infrastructure Security (Trivy)
# ============================================================
ENABLE_INFRA_SCAN=false
# Minimum severity level to block: CRITICAL, HIGH, MEDIUM, LOW
INFRA_SCAN_SEVERITY=HIGH
# Granular control per scan type (true/false)
SCAN_DOCKERFILE=true
SCAN_K8S=true
SCAN_COMPOSE=true

# ============================================================
# API — Backend (NestJS + TypeORM)
# ============================================================
API_PORT=3001
API_IMAGE=quality-scanner-api:latest
API_DB_IMAGE=postgres:15-alpine
API_DB_HOST=localhost
API_DB_PORT=5433
API_DB_USER=scanner
API_DB_PASSWORD=scanner
API_DB_NAME=quality_scanner
# Set to true ONLY in development to auto-create tables (never in production)
API_DB_SYNC=true

# ============================================================
# Dashboard
# ============================================================
DASHBOARD_PORT=3000
REPORTS_DIR=./reports

# Public SonarQube URL (used in the dashboard to generate clickable links)
SONAR_PUBLIC_URL=http://localhost:9000

# ============================================================
# Community Branch Plugin — Branch & PR Analysis
# ============================================================
# Set ONE of the blocks below when running the scanner.
# Never set both sonar.branch and sonar.pullrequest at the same time.

# Branch analysis (feature branches, release branches, etc.)
# SONAR_BRANCH_NAME=feature/my-feature

# Pull Request analysis
# SONAR_PR_KEY=123
# SONAR_PR_BRANCH=feature/my-feature
# SONAR_PR_BASE=main
# SONAR_SCM_REVISION=abc123def   # required for GitHub PRs
