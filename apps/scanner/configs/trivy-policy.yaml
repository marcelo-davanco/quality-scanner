# ============================================================
# Trivy — Infrastructure Security Policies
# Used by the Infra Scan step of Quality Scanner
# ============================================================
#
# Reference: https://aquasecurity.github.io/trivy/latest/docs/configuration/
#
# Available severities: CRITICAL, HIGH, MEDIUM, LOW, UNKNOWN
# Available scanners: misconfig, vuln, secret
# ============================================================

# Severities to report (minimum filter)
severity:
  - CRITICAL
  - HIGH
  - MEDIUM

# Active scanners for IaC
scanners:
  - misconfig

# Output format
format: json

# Do not fail automatically — blocking control is handled by infra-scan.sh
exit-code: 0

# Misconfiguration settings
misconfig:
  # Trivy built-in/Rego checkers for IaC
  # Covers: Dockerfile, Kubernetes, docker-compose, Terraform, CloudFormation
  include:
    - docker
    - kubernetes
# ============================================================
# Security Rules Covered (Trivy built-in)
# ============================================================
#
# DOCKERFILE:
#   - DS001: Base image using 'latest' tag (HIGH)
#   - DS002: Container running as root (HIGH)
#   - DS005: Use of ADD instead of COPY (LOW)
#   - DS006: Missing HEALTHCHECK (LOW)
#   - DS012: apt-get without --no-install-recommends (LOW)
#   - DS013: Missing USER instruction (HIGH)
#   - DS014: Use of sudo (MEDIUM)
#   - DS015: Missing apt-get clean (LOW)
#   - DS026: Privileged port exposed (LOW)
#
# KUBERNETES:
#   - KSV001: Containers running as root (HIGH)
#   - KSV003: Capabilities not dropped (MEDIUM)
#   - KSV006: hostNetwork enabled (HIGH)
#   - KSV009: hostPID enabled (HIGH)
#   - KSV010: hostIPC enabled (HIGH)
#   - KSV011: CPU limits not set (MEDIUM)
#   - KSV012: Missing readOnlyRootFilesystem (LOW)
#   - KSV013: Missing memory limits (MEDIUM)
#   - KSV014: Privileged container (CRITICAL)
#   - KSV020: Missing runAsNonRoot (HIGH)
#   - KSV021: Missing securityContext (HIGH)
#   - KSV030: Missing seccomp profile (MEDIUM)
#
# DOCKER-COMPOSE:
#   - Ports exposed unnecessarily
#   - Volumes with excessive permissions
#   - privileged: true
#   - Missing read_only
# ============================================================
