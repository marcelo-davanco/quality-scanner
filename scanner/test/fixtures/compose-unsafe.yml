# Unsafe docker-compose â€” should generate multiple findings in Trivy
# Used as a test fixture for the Infra Scan step

version: "3.8"

services:
  app:
    image: node:latest
    container_name: app-unsafe
    # ISSUE: Privileged container
    privileged: true
    # ISSUE: No read_only
    # ISSUE: No user (runs as root)
    # ISSUE: No cap_drop
    # ISSUE: Ports exposed on all interfaces
    ports:
      - "3000:3000"
      - "9229:9229"
    # ISSUE: Volume with full host access
    volumes:
      - /:/host-root
      - /var/run/docker.sock:/var/run/docker.sock
    environment:
      NODE_ENV: development
      # ISSUE: Hardcoded credentials
      DB_PASSWORD: super_secret_123
    # ISSUE: No healthcheck
    # ISSUE: No resource limits
    # ISSUE: Host network mode
    network_mode: host
    restart: always

  db:
    image: postgres:latest
    # ISSUE: No read_only
    # ISSUE: No user
    environment:
      POSTGRES_PASSWORD: admin123
    ports:
      - "5432:5432"
    volumes:
      - /data:/var/lib/postgresql/data
