# Unsafe Kubernetes Deployment — should generate multiple findings in Trivy
# Used as a test fixture for the Infra Scan step

apiVersion: apps/v1
kind: Deployment
metadata:
  name: app-unsafe
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app: app-unsafe
  template:
    metadata:
      labels:
        app: app-unsafe
    spec:
      # ISSUE: hostNetwork enabled (KSV006)
      hostNetwork: true
      # ISSUE: hostPID enabled (KSV009)
      hostPID: true
      # ISSUE: hostIPC enabled (KSV010)
      hostIPC: true
      # ISSUE: No securityContext on pod (KSV021)
      # ISSUE: No runAsNonRoot (KSV020)
      containers:
        - name: app
          image: node:latest
          ports:
            - containerPort: 3000
          # ISSUE: Privileged container (KSV014 — CRITICAL)
          securityContext:
            privileged: true
            allowPrivilegeEscalation: true
            # ISSUE: No readOnlyRootFilesystem (KSV012)
            # ISSUE: Capabilities not dropped (KSV003)
          # ISSUE: No CPU limits (KSV011)
          # ISSUE: No memory limits (KSV013)
          # ISSUE: No probes
          env:
            - name: DB_PASSWORD
              value: "super_secret_123"
